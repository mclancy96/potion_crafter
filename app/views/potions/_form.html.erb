<%= form_with model: @potion, local: true do |form| %>
  <div>
    <%= form.label :name %>
    <%= form.text_field :name %>
  </div>
  <div>
    <%= form.label :description %>
    <%= form.text_field :description %>
  </div>
  <div>
    <%= form.label :effect %>
    <%= form.text_field :effect %>
  </div>
  <div>
    <%= form.label :potency_level %>
    <%= form.number_field :potency_level, max: 10, min: 1 %>
  </div>
  <div>
    <%= form.label :image_url %>
    <%= form.text_field :image_url %>
  </div>
  <div>
    <h3>Ingredients</h3>
    <%= form.fields_for :potion_ingredients do |ingredient_form| %>
      <div class="ingredient-row" style="display: flex; align-items: center; gap: 8px;">
        <%= ingredient_form.label :ingredient_id, "Ingredient" %>
        <%= ingredient_form.collection_select :ingredient_id, @potion.ingredient_options(ingredient_form.object), :id, :name, { prompt: "Select an ingredient" }, { class: "ingredient-select" } %>
        <%= ingredient_form.label :quantity %>
        <%= ingredient_form.text_field :quantity, placeholder: "e.g., 2 drops, 1 pinch" %>
        <%= ingredient_form.hidden_field :_destroy, value: false, class: "destroy-flag" %>
        <span class="remove-ingredient" style="cursor:pointer; color:#c00; font-size:1.2em;" title="Remove">&#128465;</span>
      </div>
    <% end %>
  </div>
  <%= form.submit %>
<% end %>
